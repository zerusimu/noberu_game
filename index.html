<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>è–¬å±‹è¦‹ç¿’ã„ã®å†’é™º</title>
<link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <div id="background"></div> <!-- ğŸ“Œ èƒŒæ™¯å°‚ç”¨ã®è¦ç´  -->
    <div id="gameContainer">
        <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒã‚’å«ã‚€æ  -->
        <div id="characterContainer">
            <img id="character" src="" alt="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼">
                </div>
            <div id="textOverlay">
             <div id="characterName"></div> <!-- ã‚­ãƒ£ãƒ©åã‚’è¡¨ç¤º -->
                <p id="storyText">èª­ã¿è¾¼ã¿ä¸­...</p>
                <div id="choices"></div>
        
        </div>
<div id="gameMenu">
    <button onclick="saveGame()">ã‚»ãƒ¼ãƒ–</button>
    <button onclick="autoMode()">ã‚ªãƒ¼ãƒˆ</button>
    <button onclick="skipText()">ã‚¹ã‚­ãƒƒãƒ—</button>
    <button onclick="loadGame()">ãƒ­ãƒ¼ãƒ‰</button>
</div>
</div>

<script>
let allScenes = {}; // ã“ã“ã«å…¨ã‚·ãƒ¼ãƒ³ã‚’ã¾ã¨ã‚ã‚‹

// JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ allScenes ã«è¿½åŠ 
async function loadJson(file) {
  try {
    const response = await fetch(`./data/${file}`);
    const json = await response.json();
    allScenes = { ...allScenes, ...json }; // ãƒãƒ¼ã‚¸
  } catch (err) {
    console.error(`èª­ã¿è¾¼ã¿å¤±æ•—: ${file}`, err);
  }
}

// å¿…è¦ãªã™ã¹ã¦ã®JSONã‚’ãƒ­ãƒ¼ãƒ‰
async function loadAllScenes() {
  const files = ["story.json", "okane.json", "kenkou.json","zikan.json","zikokeihatu.json"];
  for (const file of files) {
    await loadJson(file);
  }
}

// ã‚·ãƒ¼ãƒ³ã‚’è¡¨ç¤º
async function loadScene(scene) {
  try {
    // allScenes ãŒã¾ã ç©ºãªã‚‰ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
    if (Object.keys(allScenes).length === 0) {
      await loadAllScenes();
    }

    const storyData = allScenes[scene];
    if (!storyData) {
      console.error("ã‚·ãƒ¼ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:", scene);
      return;
    }

    // èƒŒæ™¯
    if (storyData.background) {
      const bgDiv = document.getElementById("background");
      bgDiv.style.backgroundImage = `url('./images/${storyData.background}')`;
    }

    // ãƒ†ã‚­ã‚¹ãƒˆ
    document.getElementById("storyText").innerHTML = storyData.text;

    // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼
    const characterContainer = document.getElementById("characterContainer");
    characterContainer.innerHTML = "";

    let speakingCharacterName = "";
    if (storyData.characters) {
      storyData.characters.forEach(char => {
        let img = document.createElement("img");
        img.src = `./characters/${char.image}`;
        img.classList.add("character");

        if (char.position) img.classList.add(char.position);
        if (char.speaking) {
          img.classList.add("active");
          speakingCharacterName = char.name || "";
        }

        characterContainer.appendChild(img);
      });
    }

    const characterNameDiv = document.getElementById("characterName");
    characterNameDiv.textContent = speakingCharacterName;
    characterNameDiv.style.display = speakingCharacterName ? "block" : "none";


function updateCharacterContainer() {
  const container = document.getElementById("characterContainer");
  const characters = container.querySelectorAll(".character");
  container.className = ""; // ã‚¯ãƒ©ã‚¹ãƒªã‚»ãƒƒãƒˆ
  if (characters.length === 2) {
    container.classList.add("two");
  } else if (characters.length >= 3) {
    container.classList.add("three");
  }
}



    updateCharacterContainer();

    // âœ… é¸æŠè‚¢
    const choicesDiv = document.getElementById("choices");
    choicesDiv.innerHTML = "";
    (storyData.choices || []).forEach(choice => {
      let button = document.createElement("button");
      button.textContent = choice.text;
      button.onclick = () => loadScene(choice.next);
      choicesDiv.appendChild(button);
    });

  } catch (err) {
    console.error("ã‚¨ãƒ©ãƒ¼:", err);
  }
}

// åˆå›ãƒ­ãƒ¼ãƒ‰
loadScene("top");
</script>


</body>
</html>